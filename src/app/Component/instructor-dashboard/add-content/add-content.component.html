<div class="max-w-3xl mx-auto mt-10 bg-white shadow p-6 rounded-lg">

  <h2 class="text-2xl font-semibold text-gray-800 text-center mb-6">Course Content Management</h2>

  <!-- Tabs -->
  <div class="flex border-b border-gray-300 mb-6">
    <button
      (click)="activeTab = 'video'"
      [class.border-indigo-500]="activeTab === 'video'"
      class="py-2 px-6 border-b-2 font-semibold text-gray-700 hover:text-indigo-600 transition"
    >
      Upload Unit Video
    </button>
    <button
      (click)="activeTab = 'question'"
      [class.border-indigo-500]="activeTab === 'question'"
      class="py-2 px-6 border-b-2 font-semibold text-gray-700 hover:text-indigo-600 transition"
    >
      Create Quiz Question
    </button>
  </div>

  <!-- Upload Unit Video Form -->
  <form
    *ngIf="activeTab === 'video'"
    [formGroup]="contentForm"
    (ngSubmit)="onSubmitVideo()"
    enctype="multipart/form-data"
    class="space-y-5"
  >
    <div>
      <label class="block text-gray-700 font-medium mb-1">Select Unit</label>
      <select formControlName="unitId" class="w-full px-4 py-2 border rounded-md">
        <option value="" disabled>Select a unit</option>
        <option *ngFor="let u of filteredUnits" [value]="u.unitId">
          {{ u.title }} (Order: {{ u.order }})
        </option>
      </select>
      <div *ngIf="contentForm.get('unitId')?.invalid && contentForm.get('unitId')?.touched"
           class="text-sm text-red-600 mt-1">
        Please select a unit.
      </div>
    </div>

    <div>
      <label class="block text-gray-700 font-medium mb-1">Video Duration (minutes)</label>
      <input
        type="number"
        formControlName="duration"
        placeholder="Enter duration"
        class="w-full px-4 py-2 border rounded-md"
      />
      <div *ngIf="contentForm.get('duration')?.invalid && contentForm.get('duration')?.touched"
           class="text-sm text-red-600 mt-1">
        Duration is required and must be positive.
      </div>
    </div>

    <div>
      <label class="block text-gray-700 font-medium mb-1">Select Video File</label>
      <input
        type="file"
        (change)="onFileSelected($event)"
        class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4
               file:rounded-md file:border-0 file:text-sm file:font-semibold
               file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"
      />
    </div>

    <button
      type="submit"
      [disabled]="contentForm.invalid || !selectedFile"
      class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition disabled:opacity-50"
    >
      Upload Video
    </button>

    <div *ngIf="successMessageVideo" class="bg-green-100 border border-green-400 text-green-800 px-4 py-2 rounded mt-4">
      {{ successMessageVideo }}
    </div>
    <div *ngIf="errorMessageVideo" class="bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mt-4">
      {{ errorMessageVideo }}
    </div>
  </form>

  <!-- Create Quiz Question (Multiple + File Upload) -->
  <div *ngIf="activeTab === 'question'" class="space-y-6">

    <!-- Upload PDF/JSON Option -->
    <div class="border p-4 rounded-md bg-gray-50">
      <h3 class="text-lg font-semibold text-indigo-600 mb-3">Upload Questions via File (Optional)</h3>
      <input
        type="file"
        accept=".pdf, .json"
        (change)="onQuestionFileSelected($event)"
        class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4
               file:rounded-md file:border-0 file:text-sm file:font-semibold
               file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"
      />
      <button
        type="button"
        (click)="uploadQuestionFile()"
        [disabled]="!selectedQuestionFile"
        class="mt-3 w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition disabled:opacity-50"
      >
        Upload File
      </button>

      <div *ngIf="successMessageFile" class="bg-green-100 border border-green-400 text-green-800 px-4 py-2 rounded mt-4">
        {{ successMessageFile }}
      </div>
      <div *ngIf="errorMessageFile" class="bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mt-4">
        {{ errorMessageFile }}
      </div>
    </div>

    <!-- Manual Question Entry -->
    <div>
      <label class="block text-gray-700 font-medium mb-1">How many questions do you want to add?</label>
      <input
        type="number"
        [(ngModel)]="questionCountInput"
        name="questionCount"
        (change)="generateQuestionControls()"
        min="1"
        class="w-full px-4 py-2 border rounded-md"
        placeholder="Enter number of questions"
      />
    </div>

    <form [formGroup]="multiQuestionForm" (ngSubmit)="submitAllQuestions()" class="space-y-6">
      <div formArrayName="questions">
        <div
          *ngFor="let qCtrl of questionsArr.controls; let i = index"
          [formGroupName]="i"
          class="border p-4 rounded-md bg-gray-50"
        >
          <h3 class="text-lg font-semibold text-indigo-600 mb-2">Question #{{ i + 1 }}</h3>

          <div class="mb-3">
            <label class="block text-gray-700">Text:</label>
            <input
              formControlName="text"
              type="text"
              class="w-full px-3 py-2 border rounded-md"
              placeholder="Enter question text"
            />
          </div>

          <div class="mb-3">
            <label class="block text-gray-700">Options (comma separated):</label>
            <input
              formControlName="options"
              type="text"
              class="w-full px-3 py-2 border rounded-md"
              placeholder="Option1, Option2, Option3"
            />
          </div>

          <div class="mb-3">
            <label class="block text-gray-700">Correct Answer:</label>
            <input
              formControlName="correctAnswer"
              type="text"
              class="w-full px-3 py-2 border rounded-md"
              placeholder="Must match one of the options"
            />
          </div>
        </div>
      </div>

      <button
        type="submit"
        [disabled]="multiQuestionForm.invalid"
        class="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition disabled:opacity-50"
      >
        Submit All Questions
      </button>

      <div *ngIf="successMessageQuestion" class="bg-green-100 border border-green-400 text-green-800 px-4 py-2 rounded mt-4">
        {{ successMessageQuestion }}
      </div>
      <div *ngIf="errorMessageQuestion" class="bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded mt-4">
        {{ errorMessageQuestion }}
      </div>
    </form>
  </div>
</div>
